<div class="modal-overlay" (click)="closeModal()">
  <div class="modal-container guild-config-modal-container" (click)="$event.stopPropagation()">
    @if (_guildConfiguration) {
    <div class="guild-configuration-section-host">
      <div class="guild-configuration-title">Server Configuration</div>
      <div class="guild-configuration-description">
        Configure how the Reply Bot behaves in this server.
      </div>

      <div class="guild-configuration-actions">
        <!-- General -->
        <div class="toggle-category">
          <div class="toggle-category-title">General</div>
          <div class="toggle-row">
            <div class="toggle-item">
              <div class="toggle-switch">
                <input
                  type="checkbox"
                  class="toggle-switch-checkbox"
                  id="modal-enableDefaultReplies"
                  [(ngModel)]="_guildConfiguration.enableDefaultReplies" />
                <label class="toggle-switch-label" for="modal-enableDefaultReplies">
                  <span class="toggle-switch-inner"></span>
                  <span class="toggle-switch-switch"></span>
                </label>
              </div>
              <span class="toggle-switch-text">
                Default Replies
                <i
                  class="question-icon fa-solid fa-circle-question"
                  tooltip="Toby's default set of replies that come with the bot."></i>
              </span>
            </div>
            <div class="toggle-item">
              <div class="toggle-switch">
                <input
                  type="checkbox"
                  class="toggle-switch-checkbox"
                  id="modal-enableChannelUpdateAnnouncements"
                  name="modal-enableChannelUpdateAnnouncements"
                  [(ngModel)]="_guildConfiguration.enableChannelUpdateAnnouncements" />
                <label class="toggle-switch-label" for="modal-enableChannelUpdateAnnouncements">
                  <span class="toggle-switch-inner"></span>
                  <span class="toggle-switch-switch"></span>
                </label>
              </div>
              <span class="toggle-switch-text">Channel Update Announcements</span>
            </div>
            <div class="toggle-item">
              <div class="toggle-switch">
                <input
                  type="checkbox"
                  class="toggle-switch-checkbox"
                  id="modal-enableRepeatLinkNotifications"
                  name="modal-enableRepeatLinkNotifications"
                  [(ngModel)]="_guildConfiguration.enableRepeatLinkNotifications" />
                <label class="toggle-switch-label" for="modal-enableRepeatLinkNotifications">
                  <span class="toggle-switch-inner"></span>
                  <span class="toggle-switch-switch"></span>
                </label>
              </div>
              <span class="toggle-switch-text">Repeat Link Notifications</span>
            </div>
            <div class="toggle-item">
              <div class="toggle-switch">
                <input
                  type="checkbox"
                  class="toggle-switch-checkbox"
                  id="modal-fortniteMapOnlyNamedLocations"
                  name="modal-fortniteMapOnlyNamedLocations"
                  [(ngModel)]="_guildConfiguration.fortniteMapOnlyNamedLocations" />
                <label class="toggle-switch-label" for="modal-fortniteMapOnlyNamedLocations">
                  <span class="toggle-switch-inner"></span>
                  <span class="toggle-switch-switch"></span>
                </label>
              </div>
              <span class="toggle-switch-text">Fortnite Map Only Named Locations</span>
            </div>
          </div>
        </div>

        <!-- Avatar -->
        <div class="toggle-category">
          <div class="toggle-category-title">Avatar</div>
          <div class="toggle-row">
            <div class="toggle-item">
              <div class="toggle-switch">
                <input
                  type="checkbox"
                  class="toggle-switch-checkbox"
                  id="modal-enableAvatarAnnouncements"
                  name="modal-enableAvatarAnnouncements"
                  [(ngModel)]="_guildConfiguration.enableAvatarAnnouncements" />
                <label class="toggle-switch-label" for="modal-enableAvatarAnnouncements">
                  <span class="toggle-switch-inner"></span>
                  <span class="toggle-switch-switch"></span>
                </label>
              </div>
              <span class="toggle-switch-text">Avatar Announcements</span>
            </div>
            <div class="toggle-item">
              <div class="toggle-switch">
                <input
                  type="checkbox"
                  class="toggle-switch-checkbox"
                  id="modal-enableAvatarMentions"
                  name="modal-enableAvatarMentions"
                  [(ngModel)]="_guildConfiguration.enableAvatarMentions" />
                <label class="toggle-switch-label" for="modal-enableAvatarMentions">
                  <span class="toggle-switch-inner"></span>
                  <span class="toggle-switch-switch"></span>
                </label>
              </div>
              <span class="toggle-switch-text">Avatar Mentions</span>
            </div>
            <div class="toggle-item">
              <div class="toggle-switch">
                <input
                  type="checkbox"
                  class="toggle-switch-checkbox"
                  id="modal-enableWelcomeMessage"
                  name="modal-enableWelcomeMessage"
                  [(ngModel)]="_guildConfiguration.enableWelcomeMessage" />
                <label class="toggle-switch-label" for="modal-enableWelcomeMessage">
                  <span class="toggle-switch-inner"></span>
                  <span class="toggle-switch-switch"></span>
                </label>
              </div>
              <span class="toggle-switch-text">Welcome Message</span>
            </div>
            <div class="toggle-item">
              <div class="toggle-switch">
                <input
                  type="checkbox"
                  class="toggle-switch-checkbox"
                  id="modal-enableDepartureMessage"
                  name="modal-enableDepartureMessage"
                  [(ngModel)]="_guildConfiguration.enableDepartureMessage" />
                <label class="toggle-switch-label" for="modal-enableDepartureMessage">
                  <span class="toggle-switch-inner"></span>
                  <span class="toggle-switch-switch"></span>
                </label>
              </div>
              <span class="toggle-switch-text">Departure Message</span>
            </div>
          </div>
        </div>

        <!-- Fix Reactions -->
        <div class="toggle-category">
          <div class="toggle-category-title">Fix Reactions</div>
          <div class="toggle-row">
            <div class="toggle-item">
              <div class="toggle-switch">
                <input
                  type="checkbox"
                  class="toggle-switch-checkbox"
                  id="modal-enableFixTweetReactions"
                  name="modal-enableFixTweetReactions"
                  [(ngModel)]="_guildConfiguration.enableFixTweetReactions" />
                <label class="toggle-switch-label" for="modal-enableFixTweetReactions">
                  <span class="toggle-switch-inner"></span>
                  <span class="toggle-switch-switch"></span>
                </label>
              </div>
              <span class="toggle-switch-text">Fix Tweet Reactions</span>
            </div>
            <div class="toggle-item">
              <div class="toggle-switch">
                <input
                  type="checkbox"
                  class="toggle-switch-checkbox"
                  id="modal-enableFixInstagramReactions"
                  name="modal-enableFixInstagramReactions"
                  [(ngModel)]="_guildConfiguration.enableFixInstagramReactions" />
                <label class="toggle-switch-label" for="modal-enableFixInstagramReactions">
                  <span class="toggle-switch-inner"></span>
                  <span class="toggle-switch-switch"></span>
                </label>
              </div>
              <span class="toggle-switch-text">Fix Instagram Reactions</span>
            </div>
            <div class="toggle-item">
              <div class="toggle-switch">
                <input
                  type="checkbox"
                  class="toggle-switch-checkbox"
                  id="modal-enableFixRedditReactions"
                  name="modal-enableFixRedditReactions"
                  [(ngModel)]="_guildConfiguration.enableFixRedditReactions" />
                <label class="toggle-switch-label" for="modal-enableFixRedditReactions">
                  <span class="toggle-switch-inner"></span>
                  <span class="toggle-switch-switch"></span>
                </label>
              </div>
              <span class="toggle-switch-text">Fix Reddit Reactions</span>
            </div>
            <div class="toggle-item">
              <div class="toggle-switch">
                <input
                  type="checkbox"
                  class="toggle-switch-checkbox"
                  id="modal-enableFixThreadsReactions"
                  name="modal-enableFixThreadsReactions"
                  [(ngModel)]="_guildConfiguration.enableFixThreadsReactions" />
                <label class="toggle-switch-label" for="modal-enableFixThreadsReactions">
                  <span class="toggle-switch-inner"></span>
                  <span class="toggle-switch-switch"></span>
                </label>
              </div>
              <span class="toggle-switch-text">Fix Threads Reactions</span>
            </div>
            <div class="toggle-item">
              <div class="toggle-switch">
                <input
                  type="checkbox"
                  class="toggle-switch-checkbox"
                  id="modal-enableFixBlueskyReactions"
                  name="modal-enableFixBlueskyReactions"
                  [(ngModel)]="_guildConfiguration.enableFixBlueskyReactions" />
                <label class="toggle-switch-label" for="modal-enableFixBlueskyReactions">
                  <span class="toggle-switch-inner"></span>
                  <span class="toggle-switch-switch"></span>
                </label>
              </div>
              <span class="toggle-switch-text">Fix Bluesky Reactions</span>
            </div>
            <div class="toggle-item">
              <div class="toggle-switch">
                <input
                  type="checkbox"
                  class="toggle-switch-checkbox"
                  id="modal-enableFixTikTokReactions"
                  name="modal-enableFixTikTokReactions"
                  [(ngModel)]="_guildConfiguration.enableFixTikTokReactions" />
                <label class="toggle-switch-label" for="modal-enableFixTikTokReactions">
                  <span class="toggle-switch-inner"></span>
                  <span class="toggle-switch-switch"></span>
                </label>
              </div>
              <span class="toggle-switch-text">Fix TikTok Reactions</span>
            </div>
          </div>
        </div>

        <!-- Logging -->
        <div class="toggle-category">
          <div class="toggle-category-title">Logging</div>

          <div class="form-field" style="margin-top: 10px">
            <label for="modal-logChannelId" class="">Log Channel ID</label>
            <input
              type="text"
              id="modal-logChannelId"
              [(ngModel)]="_guildConfiguration.logChannelId"
              placeholder="Enter log channel ID"
              class="form-array-input" />
          </div>
          <div class="toggle-row">
            <div class="toggle-item">
              <div class="toggle-switch">
                <input
                  type="checkbox"
                  class="toggle-switch-checkbox"
                  id="modal-enableLoggingUserJoins"
                  name="modal-enableLoggingUserJoins"
                  [(ngModel)]="_guildConfiguration.enableLoggingUserJoins" />
                <label class="toggle-switch-label" for="modal-enableLoggingUserJoins">
                  <span class="toggle-switch-inner"></span>
                  <span class="toggle-switch-switch"></span>
                </label>
              </div>
              <span class="toggle-switch-text">Logging User Joins</span>
            </div>
            <div class="toggle-item">
              <div class="toggle-switch">
                <input
                  type="checkbox"
                  class="toggle-switch-checkbox"
                  id="modal-enableLoggingUserDepartures"
                  name="modal-enableLoggingUserDepartures"
                  [(ngModel)]="_guildConfiguration.enableLoggingUserDepartures" />
                <label class="toggle-switch-label" for="modal-enableLoggingUserDepartures">
                  <span class="toggle-switch-inner"></span>
                  <span class="toggle-switch-switch"></span>
                </label>
              </div>
              <span class="toggle-switch-text">Logging User Departures</span>
            </div>
            <div class="toggle-item">
              <div class="toggle-switch">
                <input
                  type="checkbox"
                  class="toggle-switch-checkbox"
                  id="modal-enableLoggingMessageEdits"
                  name="modal-enableLoggingMessageEdits"
                  [(ngModel)]="_guildConfiguration.enableLoggingMessageEdits" />
                <label class="toggle-switch-label" for="modal-enableLoggingMessageEdits">
                  <span class="toggle-switch-inner"></span>
                  <span class="toggle-switch-switch"></span>
                </label>
              </div>
              <span class="toggle-switch-text">Logging Message Edits</span>
            </div>
            <div class="toggle-item">
              <div class="toggle-switch">
                <input
                  type="checkbox"
                  class="toggle-switch-checkbox"
                  id="modal-enableLoggingMessageDeletes"
                  name="modal-enableLoggingMessageDeletes"
                  [(ngModel)]="_guildConfiguration.enableLoggingMessageDeletes" />
                <label class="toggle-switch-label" for="modal-enableLoggingMessageDeletes">
                  <span class="toggle-switch-inner"></span>
                  <span class="toggle-switch-switch"></span>
                </label>
              </div>
              <span class="toggle-switch-text">Logging Message Deletes</span>
            </div>
            <div class="toggle-item">
              <div class="toggle-switch">
                <input
                  type="checkbox"
                  class="toggle-switch-checkbox"
                  id="modal-enableLoggingUserBans"
                  name="modal-enableLoggingUserBans"
                  [(ngModel)]="_guildConfiguration.enableLoggingUserBans" />
                <label class="toggle-switch-label" for="modal-enableLoggingUserBans">
                  <span class="toggle-switch-inner"></span>
                  <span class="toggle-switch-switch"></span>
                </label>
              </div>
              <span class="toggle-switch-text">Logging User Bans</span>
            </div>
            <div class="toggle-item">
              <div class="toggle-switch">
                <input
                  type="checkbox"
                  class="toggle-switch-checkbox"
                  id="modal-enableLoggingUserUnBans"
                  name="modal-enableLoggingUserUnBans"
                  [(ngModel)]="_guildConfiguration.enableLoggingUserUnBans" />
                <label class="toggle-switch-label" for="modal-enableLoggingUserUnBans">
                  <span class="toggle-switch-inner"></span>
                  <span class="toggle-switch-switch"></span>
                </label>
              </div>
              <span class="toggle-switch-text">Logging User UnBans</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Two-column layout for the array fields -->
      <div class="form-array-columns">
        <!-- Admin User IDs -->
        <div class="form-array-section form-field">
          <div class="form-array-title">
            Admin User IDs
            <span class="subtitle">(numeric Discord IDs):</span>
          </div>
          @for (id of _guildConfiguration.adminUserIds; track $index; let i = $index) {
          <div class="form-array-row">
            <input
              type="text"
              [(ngModel)]="_guildConfiguration.adminUserIds[i]"
              class="form-array-input"
              placeholder="Enter numeric user ID"
              [ngClass]="{
                invalid:
                  _guildConfiguration.adminUserIds[i] &&
                  !isNumericString(_guildConfiguration.adminUserIds[i])
              }" />
            <button
              type="button"
              class="button red on-white form-array-remove"
              (click)="_guildConfiguration.adminUserIds.splice(i, 1)">
              Remove
            </button>
          </div>
          }
          <button
            type="button"
            class="button blue on-black form-array-add"
            (click)="_guildConfiguration.adminUserIds.push('')">
            Add Admin User ID
          </button>
        </div>

        <!-- Ignore Avatar Changes User IDs -->
        <div class="form-array-section form-field">
          <div class="form-array-title">
            Ignore Avatar Changes User IDs
            <span class="subtitle">(numeric Discord IDs):</span>
          </div>
          @for (id of _guildConfiguration.ignoreAvatarChangesUserIds; track $index; let i = $index)
          {
          <div class="form-array-row">
            <input
              type="text"
              [(ngModel)]="_guildConfiguration.ignoreAvatarChangesUserIds[i]"
              class="form-array-input"
              placeholder="Enter numeric user ID"
              [ngClass]="{
                invalid:
                  _guildConfiguration.ignoreAvatarChangesUserIds[i] &&
                  !isNumericString(_guildConfiguration.ignoreAvatarChangesUserIds[i])
              }" />
            <button
              type="button"
              class="button red on-white form-array-remove"
              (click)="_guildConfiguration.ignoreAvatarChangesUserIds.splice(i, 1)">
              Remove
            </button>
          </div>
          }
          <button
            type="button"
            class="button blue on-black form-array-add"
            (click)="_guildConfiguration.ignoreAvatarChangesUserIds.push('')">
            Add Ignore User ID
          </button>
        </div>
      </div>

      <div class="modal-buttons">
        <button class="modal-button button green on-black" (click)="saveConfiguration()">
          Save Changes
        </button>
        <button class="modal-button button blue on-black" (click)="closeModal()">Cancel</button>
      </div>
    </div>
    } @else {
    <p>Loading configuration...</p>
    }
  </div>
</div>
